# generated by `./generate_action_config.py melodic`
# jsk_travis
on: [push, pull_request]

jobs:
  melodic:
    runs-on: ubuntu-latest
    name: melodic

    container: ubuntu:18.04

    steps:
      - name: Install latest git ( use sudo for ros-ubuntu, remove sudo for ubuntu container), checkout@v2 uses REST API for git<2.18, which removes .git folder and does not checkout .travis submodules
        run: |
          (apt-get update && apt-get install -y sudo) || echo "OK"
          sudo apt-get update && sudo apt-get install -y software-properties-common && sudo apt-get update && sudo add-apt-repository -y ppa:git-core/ppa && sudo apt-get update && sudo apt-get install -y git
      - name: work around permission issue  # https://github.com/actions/checkout/issues/760#issuecomment-1097501613
        run: |
          set -x
          git config --global --add safe.directory $GITHUB_WORKSPACE
      - name: Checkout
        uses: actions/checkout@v3.0.2
        with:
          submodules: true
      - name: Run jsk_travis
        uses: jsk-ros-pkg/jsk_travis@master
        with:
          ROS_DISTRO : melodic
          CATKIN_PARALLEL_JOBS: '-p2'
          CATKIN_PARALLEL_TEST_JOBS: '-p1'
          ROS_PARALLEL_JOBS: "-j2"
          ROS_PARALLEL_TEST_JOBS: '-j1'
          CATKIN_TOOLS_BUILD_OPTIONS: "-iv --summarize --no-status"
          NOT_TEST_INSTALL: true
          USE_DEB: false
          ROSDEP_ADDITIONAL_OPTIONS: "-n -q -r --ignore-src --skip-keys leap_motion" # leap_motion (run_depend of hironx_tutorial) is not released on melodic.
